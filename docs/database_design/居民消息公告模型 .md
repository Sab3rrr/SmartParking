# 居民消息公告模型设计说明
## 一、文档说明
- 设计对象：智慧社区居民信息管理系统里的居民消息公告

- 设计目标：定义系统中用于存储和操作居民消息公告信息的结构化数据模型，实现入场提醒、超时预警、缴费成功等事件通过短信/微信模板消息推送，并记录通知状态

- 技术栈：Python、Pydantic库、微信支付 SDK、支付宝 SDK、Figma / 画图工具、SQLite

- 设计原则：
- 基于Pydantic库的BaseModel类，实现数据模型的定义和验证
- 每个属性都有明确的类型注解，确保数据的类型安全
- 提供必要的验证逻辑，如消息类型的合法性、通知时间的范围检查等
- 消息类型设计原则：
- 消息类型仅能为预设的有限值，包括入场提醒、超时预警、缴费成功等
- 每种消息类型对应特定的模板内容格式，确保消息推送的规范性
- 设计时间：2025年11月2日
- 设计人员：黄俊

## 二、类结构说明



### [announcement_pydantic.py](announcement_pydantic.py)



1. 在`announcement_pydantic.py`文件中，定义了一个名为`AnnouncementPydantic`的类。该类用于表示居民消息公告的数据模型，包含了消息公告的基本信息，如消息ID、居民身份证号、消息类型、内容、推送方式、通知状态、通知时间等。

2. `AnnouncementPydantic`类的属性包括：



- `message_id`: 消息ID，字符串类型，不能为空，具有唯一性



- `resident_id_card`: 居民身份证号，字符串类型，不能为空，格式需符合居民信息数据模型中身份证号的格式要求



- `message_type`: 消息类型，字符串类型，不能为空，只能是预设的入场提醒、超时预警、缴费成功等类型



- `content`: 消息内容，字符串类型，不能为空，需符合对应消息类型的模板格式



- `push_method`: 推送方式，字符串类型，不能为空，只能是短信或微信模板消息



- `notification_status`: 通知状态，字符串类型，不能为空，包括未推送、已推送、推送失败



- `notification_time`: 通知时间， datetime 类型，可以为空，若已推送或推送失败则不能为空，且不能晚于当前时间



### [announcement_model.py](announcement_model.py)



1. 在`announcement_model.py`文件中，定义了一个名为`Announcement`的类，和`AnnouncementManagement`类。

2. 类属性设计（都用私有属性，外面不能直接改）



|属性名|类型|访问控制|描述|验证规则（怎么保证数据合法）|
|---|---|---|---|---|
|`__message_id`|str|私有|消息ID|必须是字符串，不能空、不能全是空格，且具有唯一性|
|`__resident_id_card`|str|私有|居民身份证号|需符合居民信息数据模型中身份证号的3重验证规则|
|`__message_type`|str|私有|消息类型|必须是字符串，不能空，且只能是预设的有限类型|
|`__content`|str|私有|消息内容|必须是字符串，不能空、不能全是空格，且符合对应消息类型的模板格式|
|`__push_method`|str|私有|推送方式|必须是字符串，不能空，且只能是短信或微信模板消息|
|`__notification_status`|str|私有|通知状态|必须是字符串，不能空，且只能是未推送、已推送、推送失败|
|`__notification_time`|datetime|私有|通知时间|若通知状态为已推送或推送失败，则不能为None，且不能晚于当前时间|


1. 核心方法设计（每个方法做什么，怎么保证对）



|方法名|作用|输入参数|返回值|关键逻辑（为什么这么设计）|
|---|---|---|---|---|
|`__init__`|造消息公告对象|message_id, resident_id_card, message_type, content, push_method, notification_status, notification_time|无|初始化对象时对各属性进行验证，确保初始数据合法|
|`message_id`（`@property`）|读消息ID|无|str|只能读，不能直接改，保证消息ID的唯一性和稳定性|
|`resident_id_card`（`@property`）|读居民身份证号|无|str|只能读，防止随意修改关联的居民信息|
|`message_type`（`@property`）|读消息类型|无|str|只能读，确保消息类型的准确性|
|`message_type`（`@setter`）|改消息类型|value（新消息类型）|无|先验证新消息类型是否为预设的合法类型，合法才给改|
|`content`（`@property`）|读消息内容|无|str|只能读，确保消息内容的原始性|
|`content`（`@setter`）|改消息内容|value（新消息内容）|无|验证新内容是否符合对应消息类型的模板格式，合法才给改|
|`push_method`（`@property`）|读推送方式|无|str|只能读，确保推送方式的准确性|
|`push_method`（`@setter`）|改推送方式|value（新推送方式）|无|验证新推送方式是否为短信或微信模板消息，合法才给改|
|`notification_status`（`@property`）|读通知状态|无|str|只能读，了解当前消息的推送状态|
|`notification_status`（`@setter`）|改通知状态|value（新通知状态）|无|验证新状态是否为合法状态，若改为已推送或推送失败，需确保通知时间合法|
|`notification_time`（`@property`）|读通知时间|无|datetime|只能读，了解消息的推送时间|
|`notification_time`（`@setter`）|改通知时间|value（新通知时间）|无|验证新时间是否符合规则，即不能晚于当前时间，且在通知状态为已推送或推送失败时不能为空|
|`_validate_message_type`|验证消息类型（内部用）|message_type（要验的类型）|bool|检查消息类型是否为预设的合法类型，是则返回True|
|`_validate_content`|验证消息内容（内部用）|content（要验的内容）, message_type（对应消息类型）|bool|检查消息内容是否符合对应消息类型的模板格式，是则返回True|
|`_validate_push_method`|验证推送方式（内部用）|push_method（要验的方式）|bool|检查推送方式是否为短信或微信模板消息，是则返回True|
|`_validate_notification_status`|验证通知状态（内部用）|status（要验的状态）|bool|检查通知状态是否为未推送、已推送、推送失败中的一种，是则返回True|
|`_validate_notification_time`|验证通知时间（内部用）|time（要验的时间）, status（当前通知状态）|bool|若状态为已推送或推送失败，检查时间是否不为空且不晚于当前时间，符合则返回True|
|`to_json`|转 JSON 字符串|无|str（JSON）|只转消息ID、居民身份证号、消息类型、内容、推送方式、通知状态、通知时间等核心信息，私有属性不对外|
|`from_json`|从 JSON 转对象|json_str（JSON 字符串）|Announcement 对象|先查 JSON 格式对不对、有没有少信息，验证各属性合法后才造对象|


1. 辅助类：AnnouncementManager（消息公告管理类，管多个消息公告）



## 三、类关系说明



### [announcement_model.py](announcement_model.py)



1. `Announcement`类是核心类，负责表示和操作居民消息公告信息。

2. `AnnouncementManager`类是辅助类，负责管理多个消息公告对象，提供添加、删除、查询、修改通知状态等操作。



### [announcement_pydantic.py](announcement_pydantic.py)



1. `AnnouncementPydantic`类是Pydantic模型类，用于验证和序列化居民消息公告信息数据。




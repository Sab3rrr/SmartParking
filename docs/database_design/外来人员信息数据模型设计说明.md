# 外来人员信息数据模型设计说明

## 一、文档说明
- 设计对象：智慧社区外来人员信息管理系统里的外来人员信息
- 设计目标：定义系统中用于存储和操作外来人员信息的结构化数据模型
- 技术栈：Python、Pydantic库
- 设计原则：
  - 基于Pydantic库的BaseModel类，实现数据模型的定义和验证
  - 每个属性都有明确的类型注解，确保数据的类型安全
  - 提供必要的验证逻辑，如证件号（身份证/居住证等）的校验、来访日期范围检查等
- 证件设计原则：
  - 支持身份证（18位，规则同居民身份证）、居住证（以当地实际规则为准，示例中假设为15位数字组合）等有效证件，需验证格式合法性
  - 身份证校验规则同居民信息数据模型中身份证校验逻辑
- 设计时间：2025年11月02日
- 设计人员：冶成贵

## 二、类结构说明
### outsider_pydantic.py
在`outsider_pydantic.py`文件中，定义了名为`OutsiderPydantic`的类，用于表示外来人员信息的数据模型，包含外来人员的基本信息、来访信息等。

`OutsiderPydantic`类的属性包括：
- `name`：外来人员姓名，字符串类型，不能为空
- `certificate_id`：证件号（身份证或居住证等），字符串类型，不能为空，需符合对应证件格式规则
- `visit_date`：来访日期，日期类型，不能为空，不能晚于当前日期
- `visit_reason`：来访原因，字符串类型，不能为空
- `contact_person`：社区内联系人姓名，字符串类型，不能为空
- `contact_phone`：联系人电话，字符串类型，需符合手机号格式（11位数字，以1开头等规则）

 outsider_model.py
在`outsider_model.py`文件中，定义了`Outsider`类和`OutsiderManagement`类。

## 类属性设计（均为私有属性，外部不可直接修改）

| 属性名         | 类型   | 访问控制 | 描述               | 验证规则                                                                 |
|----------------|--------|----------|--------------------|--------------------------------------------------------------------------|
| `__name`       | str    | 私有     | 外来人员姓名       | 必须是字符串，不能为空、不能全为空格                                     |
| `__certificate_id` | str    | 私有     | 证件号（身份证/居住证等） | 多重验证：长度符合对应证件规则、身份证需校验出生日期和校验位、居住证需符合当地格式规则 |
| `__visit_date` | date   | 私有     | 来访日期           | 不能晚于当前日期                                                         |
| `__visit_reason` | str    | 私有     | 来访原因           | 必须是字符串，不能为空、不能全为空格                                     |
| `__contact_person` | str    | 私有     | 社区内联系人姓名   | 必须是字符串，不能为空、不能全为空格                                     |
| `__contact_phone` | str    | 私有     | 联系人电话         | 需符合手机号格式（11位数字，以1开头等）|

## 核心方法设计

| 方法名            | 作用                     | 输入参数               | 返回值       | 关键逻辑                                                                 |
|-------------------|--------------------------|------------------------|--------------|--------------------------------------------------------------------------|
| `__init__`        | 构造外来人员对象         | name, certificate_id, visit_date, visit_reason, contact_person, contact_phone | 无           | 初始化对象时对各属性进行初步合法性检查                                   |
| `name`（@property）| 读取姓名                 | 无                     | str          | 仅可读，防止外部随意修改                                                 |
| `name`（@setter） | 修改姓名                 | value（新姓名）| 无           | 检查是否为空或全空格，合法则修改                                         |
| `certificate_id`（@setter） | 修改证件号               | value（新证件号）| 无           | 调用`_validate_certificate`方法验证，不合法则报错                       |
| `_validate_certificate` | 验证证件号（内部使用）| certificate_id（待验证证件号） | bool         | 区分证件类型（身份证/居住证），分别按对应规则验证，通过则返回True         |
| `to_json`         | 转换为JSON字符串         | 无                     | str（JSON）  | 仅转换姓名、证件号、来访日期、来访原因、联系人姓名、联系人电话等核心信息，私有属性不对外 |
| `from_json`       | 从JSON字符串转换为对象   | json_str（JSON字符串）| Outsider对象 | 检查JSON格式和信息完整性，合法则构造对象                                 |

## 辅助类：OutsiderManager（外来人员管理类，管理多个外来人员对象）
- 提供添加外来人员对象、删除外来人员对象、根据证件号查询外来人员、统计来访人员数量等操作方法。

## 三、类关系说明
### outsider_model.py
- `Outsider`类是核心类，负责表示和操作外来人员信息。
- `OutsiderManager`类是辅助类，负责管理多个外来人员对象，提供添加、删除、查询、统计等操作。

### outsider_pydantic.py
- `OutsiderPydantic`类是Pydantic模型类，用于验证和序列化外来人员信息数据，确保接口交互时的数据合法性。